# Обработка ошибок. Поток `stderr` и функция `exit`

## Поток `stderr`
Обработку ошибок в [`cat`](../examples/cat_v1.c) из [раздела 7.5](7.5.md) нельзя признать идеальной. Беда в том, что если файл по какой-либо причине недоступен, сообщение об этом мы получим по окончании конкатенируемого вывода. Это нас устроило бы, если бы вывод отправлялся только на экран, a не в файл или по конвейеру другой программе. Чтобы лучше справиться с этой проблемой, программе помимо стандартного вывода `stdout` придается еще один выходной поток, называемый `stderr` (_standart error_ -- _стандартный поток ошибок_). Вывод в `stderr` обычно отправляется на экран, даже если вывод `stdout` перенаправлен в другое место. Перепишем cat так, чтобы сообщения об ошибках отправлялись в `stderr`.

[Реализация](../examples/cat_v2.c) с перенаправлением ошибок в `stderr`.

Программа сигнализирует об ошибках двумя способами. Первый - сообщение об ошибке с помощью `fprintf` посылается в `stderr` с тем, чтобы оно попало на экран, а не оказалось на конвейере или в другом файле вывода. Имя программы, хранящееся в `argv[0]`, мы включили в сообщение, чтобы в случаях, когда данная программа работает совместно с другими, был ясен источник ошибки.

Второй способ указать на ошибку - обратиться к библиотечной функции `exit`, завершающей работу программы. Аргумент функции `exit` доступен некоторому процессу, вызвавшему данный процесс. А следовательно, успешное или ошибочное завершение программы можно проконтролировать с помощью некоей программы, которая рассматривает эту программу в качестве подчиненного процесса. По общей договоренности возврат нуля сигнализирует о том, что работа прошла нормально, в то время как ненулевые значения обычно говорят об ошибках. Чтобы опорожнить буфера, накопившие информацию для всех открытых файлов вывода, функция `exit` вызывает `fclose`.

Инструкция `return exp` главной программы `main` эквивалентна обращению к функции `exit(exp)`. Последний вариант (с помощью `exit`) имеет то преимущество, что он пригоден для выхода и из других функций, и, кроме того, слово `exit` легко обнаружить с помощью программы контекстного поиска, похожей на ту, которую мы рассматривали в главе 5. Функция `ferror` выдает ненулевое значение, если в файле `fp` была обнаружена ошибка.
```c
int ferror(FILE *fp)
```